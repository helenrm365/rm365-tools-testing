<!-- Inventory Adjustments Page -->
<div class="inventory-adjustments">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Stock Adjustments</h1>
      <p class="page-subtitle">Scan barcodes to quickly update inventory levels across all locations</p>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="inner-tabs">
    <button class="tab-button" onclick="location.href='/inventory/management'">
      <i class="fas fa-boxes"></i>
      <span>Management</span>
    </button>
    <button class="tab-button active" onclick="location.href='/inventory/adjustments'">
      <i class="fas fa-sliders-h"></i>
      <span>Adjustments</span>
    </button>
  </div>

  <!-- Main Content Wrapper -->
  <div class="adjustments-wrapper">
    <!-- Primary Section -->
    <div class="adjustments-section">
      <!-- Scanner Section -->
      <div class="scanner-section">
        <div class="section-header">
          <div class="section-icon">
            <i class="fas fa-barcode"></i>
          </div>
          <div class="section-title-group">
            <h3 class="section-title">Scanner-Ready Adjustments</h3>
            <p class="section-subtitle">Click anywhere to activate scanner input</p>
          </div>
        </div>

        <!-- Scanner Interface -->
        <div class="scanner-interface">
          <div class="scanner-status-badge">
            <i class="fas fa-check-circle"></i>
            <span>Ready to Scan</span>
          </div>

          <!-- Form Grid -->
          <div class="form-grid">
            <!-- Barcode Input -->
            <div class="form-field">
              <label class="form-label">
                <i class="fas fa-barcode"></i>
                Barcode/SKU
              </label>
              <input type="text" id="barcodeInput" class="modern-input barcode-input" placeholder="Scan or type barcode...">
              <div id="scanStatus" class="status-message"></div>
            </div>

            <!-- Quantity -->
            <div class="form-field">
              <label class="form-label">
                <i class="fas fa-hashtag"></i>
                Qty
              </label>
              <input type="number" id="quantityInput" class="modern-input qty-input" value="1" min="1">
            </div>

            <!-- Reason Dropdown -->
            <div class="form-field">
              <label class="form-label">
                <i class="fas fa-clipboard-list"></i>
                Reason
              </label>
              <div class="dropdown-container" id="reasonDropdown">
                <button class="dropdown-toggle" id="reasonToggle">
                  Pick/Pack <span class="arrow">▼</span>
                </button>
                <div class="dropdown-content">
                  <button class="dropdown-item" data-value="pick_pack" data-type="out">Pick/Pack</button>
                  <button class="dropdown-item" data-value="received" data-type="in">Received</button>
                  <button class="dropdown-item" data-value="damaged" data-type="out">Damaged</button>
                  <button class="dropdown-item" data-value="returned" data-type="in">Returned</button>
                  <button class="dropdown-item" data-value="lost" data-type="out">Lost</button>
                  <button class="dropdown-item" data-value="found" data-type="in">Found</button>
                  <button class="dropdown-item" data-value="correction" data-type="correction">Correction</button>
                </div>
              </div>
            </div>

            <!-- Field Dropdown -->
            <div class="form-field">
              <label class="form-label">
                <i class="fas fa-map-marker-alt"></i>
                Location
              </label>
              <div class="dropdown-container" id="fieldDropdown">
                <button class="dropdown-toggle" id="fieldToggle">
                  Shelf &lt; 1 <span class="arrow">▼</span>
                </button>
                <div class="dropdown-content">
                  <button class="dropdown-item" data-value="shelf_lt1_qty">Shelf &lt; 1 Year</button>
                  <button class="dropdown-item" data-value="shelf_gt1_qty">Shelf &gt; 1 Year</button>
                  <button class="dropdown-item" data-value="top_floor_total">Top Floor</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="action-buttons">
            <button id="submitBtn" class="primary-btn">
              <i class="fas fa-check-circle"></i>
              Submit Adjustment
            </button>
            
            <div class="checkbox-group">
              <input type="checkbox" id="autoSubmit" checked>
              <label for="autoSubmit">Auto-submit on scan</label>
            </div>
            
            <div class="checkbox-group">
              <input type="checkbox" id="autoSync" checked>
              <label for="autoSync">Auto-sync to Zoho</label>
            </div>
          </div>

          <!-- Status Message -->
          <div id="statusMessage" class="status-message"></div>
        </div>
      </div>

      <!-- Sync Controls -->
      <div class="sync-controls">
        <div class="sync-button-group">
          <button id="syncBtn" class="secondary-btn">
            <i class="fas fa-sync-alt"></i>
            Sync to Zoho
          </button>
          <button id="viewPendingBtn" class="tertiary-btn">
            <i class="fas fa-list"></i>
            View Pending
          </button>
        </div>
        <div id="syncStatus" class="sync-status" style="display: none;"></div>
      </div>
    </div>

    <!-- Sidebar Section -->
    <div class="sidebar-section">
      <!-- Connection Status Card -->
      <div class="info-card">
        <h4 class="info-card-title">
          <i class="fas fa-wifi"></i>
          Connection Status
        </h4>
        <div style="display: flex; align-items: center; gap: 1rem; font-size: 0.9rem;">
          <span>Status:</span>
          <span id="connectionIndicator" class="connection-status">Checking...</span>
        </div>
      </div>

      <!-- Recent Adjustments Card -->
      <div class="info-card">
        <h4 class="info-card-title">
          <i class="fas fa-history"></i>
          Recent Adjustments
        </h4>
        <div id="recentAdjustmentsTable" style="max-height: 300px; overflow-y: auto;">
          <p class="empty-state">Recent adjustments will appear here...</p>
        </div>
      </div>

      <!-- Tips Section -->
      <div class="info-card tips-section">
        <h4 class="info-card-title">
          <i class="fas fa-lightbulb"></i>
          How It Works
        </h4>
        <ul>
          <li><strong>Manual Selection Required:</strong> When scanning items, you must manually select which location to affect using the "Location" dropdown (Shelf &lt; 1 Year, Shelf &gt; 1 Year, or Top Floor).</li>
          <li><strong>Best Practice:</strong> When picking/packing orders, prioritize taking from "Shelf &lt; 1 Year" first to ensure older stock is used before expiration.</li>
          <li><strong>Adjustment Types:</strong>
            <ul style="margin-top: 0.5rem;">
              <li><em>Outbound</em> (Pick/Pack, Damaged, Lost) will <strong>reduce</strong> inventory</li>
              <li><em>Inbound</em> (Received, Returned, Found) will <strong>add</strong> to inventory</li>
              <li><em>Correction</em> allows manual adjustment in either direction</li>
            </ul>
          </li>
          <li><strong>Real-time Updates:</strong> Changes happen immediately upon submission, even before syncing to Zoho.</li>
          <li><strong>Zoho Sync:</strong> Adjustments are logged locally first, then synced to Zoho either automatically (if enabled) or manually.</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Global Dropdown Backdrop -->
<div id="globalDropdownBackdrop" class="dropdown-backdrop"></div>

<!-- Universal Footer -->
<div id="footerPlaceholder"></div>
<script>
  if (!document.getElementById('universalFooter')) {
    fetch('/components/universal-footer.html')
      .then(response => response.text())
      .then(html => {
        document.getElementById('footerPlaceholder').innerHTML = html;
      })
      .catch(error => console.error('Error loading footer:', error));
  }
</script>
